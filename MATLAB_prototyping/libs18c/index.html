<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Passing Data</title>
</head>
<body>
    <script async type="text/javascript" src="./dist/libsc18c.js"></script>
    <script>
        // JavaScript Array to Emscripten Heap
        function _arrayToHeap(typedArray) {
            var numBytes = typedArray.length * typedArray.BYTES_PER_ELEMENT;
            var ptr = Module._malloc(numBytes);
            var heapBytes = new Uint8Array(Module.HEAPU8.buffer, ptr, numBytes);
            heapBytes.set(new Uint8Array(typedArray.buffer));
            return heapBytes;
        }
        // Emscripten Heap to JavasSript Array
        function _heapToString(heapBytes, array) {
            return new TextDecoder("utf-8").decode(heapBytes);
        }
        function _heapToArray_float32(heapBytes, array) {
            return new Float32Array(
                heapBytes.buffer,
                heapBytes.byteOffset,
                heapBytes.length / array.BYTES_PER_ELEMENT);
        }
        // Free Heap
        function _freeArray(heapBytes) {
            Module._free(heapBytes.byteOffset);
        }
        // Example of Passing Data Arrays
        var Module = {
            onRuntimeInitialized: function () {
                var a = new Array(1920 * 1080 * 3).fill(0);;
                // Create Data    
                var buff_input_frame = new Uint8Array(a);
                var buff_output_code = new Uint8Array(24);
                var buff_output_roi = new Float32Array(4);
                
                // Move Data to Heap
                var bytes_input_frame = _arrayToHeap(buff_input_frame);
                var bytes_output_code = _arrayToHeap(buff_output_code);
                var bytes_output_roi = _arrayToHeap(buff_output_roi);
                // Run Function
                Module._libsc18c_initialize();
                Module._detectHD(bytes_input_frame.byteOffset, bytes_output_code.byteOffset,bytes_output_roi.byteOffset)
                Module._libsc18c_terminate();
                //  Copy Data from Heap
                buff_output_code = _heapToString(bytes_output_code, buff_output_code);
                var barcode = Array.from(buff_output_code);
                var roi = Array.from(buff_output_roi);
                // Free Data from Heap
                _freeArray(bytes_input_frame);
                _freeArray(bytes_output_code);
                _freeArray(bytes_output_roi);
                // Display Results
                console.log(a.length + ": " + buff_output_code);
                console.log(roi);
            }
        };
    </script>
</body>
</html>
